<div class="container mt-4">
  @if (isAdmin()) {
    <div class="alert alert-info">
      <fa-icon icon="info-circle"></fa-icon>
      <span class="ms-2">Shopping cart functionality is not available for administrators.</span>
    </div>
  } @else {
    <h2>My Shopping Cart</h2>

    @if (isLoading) {
      <div class="text-center">
        <div class="spinner-border" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>
    } @else {
      @if (cart(); as currentCart) {
        @if (!currentCart.items || currentCart.items.length === 0) {
          <div class="alert alert-info">
            <p class="mb-3">Your cart is empty</p>
            <button class="btn btn-primary" (click)="continueShopping()">
              <fa-icon icon="book"></fa-icon>
              <span class="ms-2">Continue Shopping</span>
            </button>
          </div>
        } @else {
          <div class="table-responsive">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>Book</th>
                  <th>Author</th>
                  <th class="text-end">Price</th>
                  <th class="text-center">Quantity</th>
                  <th class="text-end">Subtotal</th>
                </tr>
              </thead>
              <tbody>
                @for (item of currentCart.items; track item.id) {
                  <tr>
                    <td>
                      <a [routerLink]="['/book', item.book?.id, 'view']">{{ item.book?.title }}</a>
                    </td>
                    <td>{{ item.book?.author }}</td>
                    <td class="text-end">${{ item.book?.price | number: '1.2-2' }}</td>
                    <td class="text-center">{{ item.quantity }}</td>
                    <td class="text-end">${{ (item.book?.price ?? 0) * (item.quantity ?? 0) | number: '1.2-2' }}</td>
                  </tr>
                }
              </tbody>
              <tfoot>
                <tr class="table-active">
                  <th colspan="4" class="text-end">Total:</th>
                  <th class="text-end">${{ getTotalPrice() | number: '1.2-2' }}</th>
                </tr>
              </tfoot>
            </table>
          </div>

          <div class="d-flex justify-content-between mt-4">
            <button class="btn btn-secondary" (click)="continueShopping()">
              <fa-icon icon="arrow-left"></fa-icon>
              <span class="ms-2">Continue Shopping</span>
            </button>
            <button class="btn btn-success btn-lg">
              <fa-icon icon="credit-card"></fa-icon>
              <span class="ms-2">Proceed to Checkout</span>
            </button>
          </div>
        }
      } @else {
        <div class="alert alert-warning">
          <p>Unable to load your cart. Please try again.</p>
          <button class="btn btn-primary" (click)="loadCart()">
            <fa-icon icon="sync"></fa-icon>
            <span class="ms-2">Retry</span>
          </button>
        </div>
      }
    }
  }
</div>
